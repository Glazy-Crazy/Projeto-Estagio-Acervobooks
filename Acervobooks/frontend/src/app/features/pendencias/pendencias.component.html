<div class="page-wrapper">
  <app-sidebar></app-sidebar>

  <div class="container">
  <div class="header">
    <h1>ğŸ“š Meus EmprÃ©stimos</h1>
    <p class="subtitle">Acompanhe seus emprÃ©stimos e prazos de devoluÃ§Ã£o</p>
  </div>

  <!-- Mensagens -->
  <div *ngIf="mensagemSucesso" class="alert alert-success">
    âœ“ {{ mensagemSucesso }}
  </div>

  <div *ngIf="mensagemErro" class="alert alert-error">
    âœ— {{ mensagemErro }}
  </div>

  <div *ngIf="loading" class="loading">Carregando...</div>

  <!-- EmprÃ©stimos Ativos -->
  <div *ngIf="!loading && emprestimosAtivos.length > 0">
    <h2 class="section-title">âœ… EmprÃ©stimos Ativos</h2>
    <div class="pendencias-list">
      <div *ngFor="let emp of emprestimosAtivos" class="pendencia-card" [class.ultimo-dia]="calcularDiasRestantes(emp.dataPrevistaDevolucao) <= 1">
        <div class="capa">
          <img [src]="emp.livroCapaUrl || 'assets/book-placeholder.png'" [alt]="emp.livroTitulo" />
        </div>
        <div class="info">
          <h3>{{ emp.livroTitulo }}</h3>
          <p class="autor">{{ emp.livroAutor }}</p>
          <p class="data-emprestimo">ğŸ“… Emprestado em: {{ formatDate(emp.dataEmprestimo) }}</p>
          <p class="data-prevista">ğŸ“† DevoluÃ§Ã£o prevista: {{ formatDate(emp.dataPrevistaDevolucao) }}</p>
          <div class="alerta-container">
            <span class="dias-restantes" [class.ultimo-dia]="calcularDiasRestantes(emp.dataPrevistaDevolucao) <= 1">
              {{ calcularDiasRestantes(emp.dataPrevistaDevolucao) }} 
              {{ calcularDiasRestantes(emp.dataPrevistaDevolucao) === 1 ? 'dia restante' : 'dias restantes' }}
            </span>
          </div>
          <div class="acoes">
            <button class="btn-devolver" (click)="devolverLivro(emp.id!)">
              ğŸ”„ Devolver
            </button>
            <button 
              *ngIf="podeRenovar(emp)" 
              class="btn-renovar" 
              (click)="renovarEmprestimo(emp.id!)">
              â° Renovar (+7 dias)
            </button>
            <span *ngIf="!podeRenovar(emp) && calcularDiasRestantes(emp.dataPrevistaDevolucao) > 1" class="info-renovacao">
              RenovaÃ§Ã£o disponÃ­vel no Ãºltimo dia
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PendÃªncias (Atrasados) -->
  <div *ngIf="!loading && pendencias.length > 0" style="margin-top: 2rem;">
    <h2 class="section-title">âš ï¸ PendÃªncias (Em Atraso)</h2>
    <div class="pendencias-list">
      <div *ngFor="let pend of pendencias" class="pendencia-card atrasada">
        <div class="capa">
          <img [src]="pend.livroCapaUrl || 'assets/book-placeholder.png'" [alt]="pend.livroTitulo" />
        </div>
        <div class="info">
          <h3>{{ pend.livroTitulo }}</h3>
          <p class="autor">{{ pend.livroAutor }}</p>
          <p class="data-emprestimo">ğŸ“… Emprestado em: {{ formatDate(pend.dataEmprestimo) }}</p>
          <p class="data-prevista">ğŸ“† DevoluÃ§Ã£o prevista: {{ formatDate(pend.dataPrevistaDevolucao) }}</p>
          <div class="alerta-container">
            <span class="alerta-badge">âŒ ATRASADO</span>
            <span class="dias-atraso">{{ calcularDiasAtraso(pend.dataPrevistaDevolucao) }} dias de atraso</span>
          </div>
          <button class="btn-devolver" (click)="devolverLivro(pend.id!)">
            ğŸ”„ Devolver Agora
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && pendencias.length === 0 && emprestimosAtivos.length === 0" class="empty success">
    <h2>âœ… Nenhum emprÃ©stimo ativo</h2>
    <p>VocÃª nÃ£o possui livros emprestados no momento</p>
  </div>
  </div>
</div>
